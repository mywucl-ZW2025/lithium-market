<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é”‚çŸ¿ä¸ç¢³é…¸é”‚å¸‚åœºæ—¥æŠ¥</title>
    
    <!-- ECharts åº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.3/echarts.min.js"></script>
    
    <!-- html2canvas å’Œ jsPDF åº“ï¼ˆç”¨äº PDF å¯¼å‡ºï¼‰ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
            color: #333;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        /* ===== é¡¶éƒ¨æ‘˜è¦åŒºåŸŸ ===== */
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 8px;
            font-weight: 700;
        }
        
        .header .date-info {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 15px;
        }
        
        .ai-summary {
            background: rgba(255, 255, 255, 0.15);
            padding: 12px 15px;
            border-radius: 8px;
            font-size: 14px;
            line-height: 1.6;
            border-left: 4px solid #ffd700;
            margin-bottom: 10px;
        }
        
        /* ===== åŠŸèƒ½æŒ‰é’® ===== */
        .action-bar {
            display: flex;
            gap: 10px;
            padding: 15px 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #e9ecef;
            color: #333;
        }
        
        .btn-secondary:hover {
            background: #dee2e6;
        }
        
        /* ===== å†…å®¹åŒºåŸŸ ===== */
        .content {
            padding: 20px;
        }
        
        /* ===== ä»·æ ¼çœ‹æ¿ ===== */
        .price-dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .price-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease;
        }
        
        .price-card:hover {
            transform: translateY(-5px);
        }
        
        .price-card.up {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
        }
        
        .price-card.down {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        }
        
        .price-card h3 {
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .price-value {
            font-size: 28px;
            font-weight: 700;
            color: #333;
            margin-bottom: 8px;
        }
        
        .price-unit {
            font-size: 12px;
            color: #999;
        }
        
        .price-change {
            font-size: 14px;
            font-weight: 600;
            margin-top: 8px;
            padding: 5px 10px;
            border-radius: 4px;
            display: inline-block;
        }
        
        .change-up {
            background: #ffebee;
            color: #c62828;
        }
        
        .change-down {
            background: #e8f5e9;
            color: #2e7d32;
        }
        
        /* ===== å›¾è¡¨åŒºåŸŸ ===== */
        .chart-section {
            margin-bottom: 25px;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 700;
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
            display: inline-block;
        }
        
        .chart-container {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        #priceChart {
            width: 100%;
            height: 300px;
        }
        
        #supplyDemandChart {
            width: 100%;
            height: 300px;
        }
        
        /* ===== åˆ†ææ–‡å­—åŒºåŸŸ ===== */
        .analysis-section {
            background: #f0f4ff;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
            margin-bottom: 20px;
        }
        
        .analysis-section h3 {
            font-size: 16px;
            color: #333;
            margin-bottom: 12px;
            font-weight: 700;
        }
        
        .analysis-section p {
            font-size: 14px;
            line-height: 1.8;
            color: #555;
            margin-bottom: 10px;
        }
        
        .analysis-section ul {
            margin-left: 20px;
            font-size: 14px;
            line-height: 1.8;
            color: #555;
        }
        
        .analysis-section li {
            margin-bottom: 8px;
        }
        
        /* ===== é¢„æµ‹åŒºåŸŸ ===== */
        .forecast-box {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            padding: 18px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .forecast-box h4 {
            font-size: 14px;
            color: #d84315;
            margin-bottom: 8px;
            font-weight: 700;
        }
        
        .forecast-box p {
            font-size: 13px;
            color: #555;
            line-height: 1.6;
        }
        
        /* ===== åº•éƒ¨ä¿¡æ¯ ===== */
        .footer {
            background: #f8f9fa;
            padding: 15px 20px;
            text-align: center;
            font-size: 12px;
            color: #999;
            border-top: 1px solid #e9ecef;
        }
        
        /* ===== åŠ è½½åŠ¨ç”» ===== */
        .loading {
            text-align: center;
            padding: 40px 20px;
            color: #999;
        }
        
        .spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ===== å“åº”å¼è®¾è®¡ ===== */
        @media screen and (max-width: 600px) {
            .container {
                border-radius: 0;
                margin: 0;
                min-height: 100vh;
            }
            
            .header {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 22px;
            }
            
            .price-dashboard {
                grid-template-columns: 1fr;
            }
            
            .price-card {
                padding: 15px;
            }
            
            .price-value {
                font-size: 24px;
            }
            
            .action-bar {
                padding: 12px 15px;
            }
            
            .btn {
                padding: 9px 16px;
                font-size: 13px;
            }
            
            .content {
                padding: 15px;
            }
            
            .section-title {
                font-size: 16px;
            }
            
            #priceChart {
                height: 250px;
            }
            
            #supplyDemandChart {
                height: 250px;
            }
            
            .analysis-section {
                padding: 15px;
            }
            
            .analysis-section h3 {
                font-size: 14px;
            }
            
            .analysis-section p,
            .analysis-section ul {
                font-size: 13px;
            }
        }
        
        /* ===== æ‰“å°æ ·å¼ï¼ˆç”¨äº PDF å¯¼å‡ºï¼‰ ===== */
        @media print {
            body {
                background: white;
                padding: 0;
            }
            
            .container {
                box-shadow: none;
                border-radius: 0;
                max-width: 100%;
            }
            
            .action-bar {
                display: none;
            }
            
            .btn {
                display: none;
            }
            
            .header {
                page-break-after: avoid;
            }
            
            .chart-section {
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é¡¶éƒ¨æ‘˜è¦ -->
        <div class="header">
            <h1>ğŸ”‹ é”‚çŸ¿ä¸ç¢³é…¸é”‚å¸‚åœºæ—¥æŠ¥</h1>
            <div class="date-info">
                <span id="reportDate">æ•°æ®åŠ è½½ä¸­...</span>
            </div>
            <div class="ai-summary" id="aiSummary">
                <span class="spinner"></span>
                <p>æ­£åœ¨ç”Ÿæˆæ™ºèƒ½åˆ†ææ‘˜è¦...</p>
            </div>
        </div>
        
        <!-- åŠŸèƒ½æŒ‰é’® -->
        <div class="action-bar">
            <button class="btn btn-primary" onclick="exportPDF()">
                ğŸ“¥ å¯¼å‡º PDF æŠ¥å‘Š
            </button>
            <button class="btn btn-secondary" onclick="refreshData()">
                ğŸ”„ åˆ·æ–°æ•°æ®
            </button>
        </div>
        
        <!-- ä¸»è¦å†…å®¹ -->
        <div class="content">
            <!-- ä»·æ ¼çœ‹æ¿ -->
            <div class="price-dashboard">
                <div class="price-card" id="batteryCard">
                    <h3>ç”µæ± çº§ç¢³é…¸é”‚</h3>
                    <div class="price-value" id="batteryPrice">-</div>
                    <div class="price-unit">å…ƒ/å¨</div>
                    <div class="price-change" id="batteryChange">-</div>
                </div>
                
                <div class="price-card" id="industrialCard">
                    <h3>å·¥ä¸šçº§ç¢³é…¸é”‚</h3>
                    <div class="price-value" id="industrialPrice">-</div>
                    <div class="price-unit">å…ƒ/å¨</div>
                    <div class="price-change" id="industrialChange">-</div>
                </div>
                
                <div class="price-card" id="futuresCard">
                    <h3>æœŸè´§ä¸»åŠ›åˆçº¦</h3>
                    <div class="price-value" id="futuresPrice">-</div>
                    <div class="price-unit">å…ƒ/å¨</div>
                    <div class="price-change" id="futuresChange">-</div>
                </div>
                
                <div class="price-card">
                    <h3>ä»·æ ¼å·®å¼‚</h3>
                    <div class="price-value" id="priceDiff">-</div>
                    <div class="price-unit">å…ƒ/å¨</div>
                    <div class="price-change" id="diffAnalysis">ç°è´§é«˜äºæœŸè´§</div>
                </div>
            </div>
            
            <!-- ä»·æ ¼èµ°åŠ¿å›¾ -->
            <div class="chart-section">
                <div class="section-title">ğŸ“ˆ ä»·æ ¼èµ°åŠ¿åˆ†æï¼ˆè¿‘30å¤©ï¼‰</div>
                <div class="chart-container">
                    <div id="priceChart"></div>
                </div>
            </div>
            
            <!-- ä¾›éœ€åˆ†æ -->
            <div class="chart-section">
                <div class="section-title">âš–ï¸ ä¾›éœ€å¹³è¡¡åˆ†æ</div>
                <div class="chart-container">
                    <div id="supplyDemandChart"></div>
                </div>
            </div>
            
            <!-- å¸‚åœºåˆ†æ -->
            <div class="analysis-section">
                <h3>ğŸ“Š å¸‚åœºåˆ†æè¦ç‚¹</h3>
                <p><strong>ç°è´§å¸‚åœºï¼š</strong>ç”µæ± çº§ç¢³é…¸é”‚ä½œä¸ºé”‚ç”µæ± çš„é‡è¦åŸæ–™ï¼Œå…¶ä»·æ ¼æ³¢åŠ¨ç›´æ¥å½±å“æ–°èƒ½æºæ±½è½¦äº§ä¸šé“¾ã€‚å½“å‰å¸‚åœºä¾›ç»™ç›¸å¯¹å……è¶³ï¼Œä½†éœ€æ±‚ç«¯å—ä¸‹æ¸¸å¤‡è´§å‘¨æœŸå½±å“ï¼Œä»·æ ¼å‘ˆç°é«˜ä½éœ‡è¡æ€åŠ¿ã€‚</p>
                <p><strong>æœŸè´§å¸‚åœºï¼š</strong>ç¢³é…¸é”‚æœŸè´§åˆçº¦åœ¨å¹¿å·æœŸè´§äº¤æ˜“æ‰€ä¸Šå¸‚äº¤æ˜“ï¼Œæ˜¯å¸‚åœºå‚ä¸è€…è¿›è¡Œé£é™©å¯¹å†²å’Œä»·æ ¼å‘ç°çš„é‡è¦å·¥å…·ã€‚æœŸè´§ä»·æ ¼é€šå¸¸é¢†å…ˆç°è´§ä»·æ ¼ï¼Œåæ˜ å¸‚åœºå¯¹æœªæ¥ä¾›éœ€å…³ç³»çš„é¢„æœŸã€‚</p>
                <p><strong>å…³é”®é©±åŠ¨å› ç´ ï¼š</strong></p>
                <ul>
                    <li>ğŸ”¹ æ–°èƒ½æºæ±½è½¦äº§é”€æ•°æ®ï¼šç›´æ¥å½±å“é”‚ç›éœ€æ±‚</li>
                    <li>ğŸ”¹ ä¸Šæ¸¸é”‚çŸ¿ä¾›åº”ï¼šæ¾³å¤§åˆ©äºšã€æ™ºåˆ©ç­‰ä¸»è¦äº§åœ°çš„äº§é‡å˜åŒ–</li>
                    <li>ğŸ”¹ åº“å­˜æ°´ä½ï¼šæ¸¯å£é”‚ç²¾çŸ¿åº“å­˜å’Œå›½å†…ç¢³é…¸é”‚åº“å­˜</li>
                    <li>ğŸ”¹ æ”¿ç­–æ”¯æŒï¼šæ–°èƒ½æºè¡¥è´´æ”¿ç­–å’Œäº§ä¸šè§„åˆ’</li>
                    <li>ğŸ”¹ å›½é™…å¸‚åœºï¼šå…¨çƒé”‚çŸ¿ä¾›éœ€å¹³è¡¡å’Œæ±‡ç‡å˜åŒ–</li>
                </ul>
            </div>
            
            <!-- çŸ­æœŸé¢„æµ‹ -->
            <div class="forecast-box">
                <h4>ğŸ¯ çŸ­æœŸä»·æ ¼é¢„æµ‹ï¼ˆ1-2å‘¨ï¼‰</h4>
                <p>åŸºäºå½“å‰ä¾›éœ€çŠ¶å†µå’ŒæŠ€æœ¯é¢åˆ†æï¼Œç”µæ± çº§ç¢³é…¸é”‚ä»·æ ¼é¢„è®¡åœ¨ <strong>78,000-82,000 å…ƒ/å¨</strong> åŒºé—´å†…æ³¢åŠ¨ã€‚å…³é”®æ”¯æ’‘ä½åœ¨ 78,000 å…ƒ/å¨ï¼Œå…³é”®é˜»åŠ›ä½åœ¨ 82,000 å…ƒ/å¨ã€‚å»ºè®®æŠ•èµ„è€…å¯†åˆ‡å…³æ³¨ä¸‹å‘¨æ–°èƒ½æºæ±½è½¦äº§é”€æ•°æ®å’Œè¿›å£é”‚ç²¾çŸ¿åˆ°è´§æƒ…å†µã€‚</p>
            </div>
            
            <!-- ä¸­æœŸå±•æœ› -->
            <div class="forecast-box" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);">
                <h4 style="color: #0277bd;">ğŸ“… ä¸­æœŸå±•æœ›ï¼ˆ1-3ä¸ªæœˆï¼‰</h4>
                <p>éšç€æ–°èƒ½æºæ±½è½¦äº§ä¸šçš„æŒç»­å‘å±•å’Œé”‚çŸ¿äº§èƒ½çš„é€æ­¥é‡Šæ”¾ï¼Œé”‚ç›å¸‚åœºæœ‰æœ›å®ç°ä¾›éœ€å†å¹³è¡¡ã€‚é¢„è®¡ç¢³é…¸é”‚ä»·æ ¼å°†åœ¨ <strong>75,000-85,000 å…ƒ/å¨</strong> çš„åˆç†åŒºé—´å†…è¿è¡Œã€‚æ”¿ç­–é¢çš„ä»»ä½•é‡å¤§è°ƒæ•´éƒ½å¯èƒ½æˆä¸ºä»·æ ¼çš„é‡è¦è½¬æŠ˜ç‚¹ã€‚</p>
            </div>
        </div>
        
        <!-- åº•éƒ¨ä¿¡æ¯ -->
        <div class="footer">
            <p>ğŸ“Œ æ•°æ®æ¥æºï¼šSMMï¼ˆä¸Šæµ·æœ‰è‰²ç½‘ï¼‰ã€å¹¿å·æœŸè´§äº¤æ˜“æ‰€ | æ›´æ–°æ—¶é—´ï¼š<span id="updateTime">-</span></p>
            <p>âš ï¸ å…è´£å£°æ˜ï¼šæœ¬æŠ¥å‘Šä»…ä¾›å‚è€ƒï¼Œä¸æ„æˆæŠ•èµ„å»ºè®®ã€‚å¸‚åœºé£é™©è¯·è‡ªè¡Œè¯„ä¼°ã€‚</p>
        </div>
    </div>
    
    <script>
        // å…¨å±€å˜é‡
        let chartInstance1 = null;
        let chartInstance2 = null;
        let marketData = null;
        
        // é¡µé¢åŠ è½½æ—¶è·å–æ•°æ®
        document.addEventListener('DOMContentLoaded', function() {
            loadMarketData();
        });
        
        // åŠ è½½å¸‚åœºæ•°æ®
        function loadMarketData() {
            // ä» data/market_data.json åŠ è½½æ•°æ®
            fetch('data/market_data.json')
                .then(response => response.json())
                .then(data => {
                    marketData = data;
                    renderUI();
                    initCharts();
                })
                .catch(error => {
                    console.error('æ•°æ®åŠ è½½å¤±è´¥:', error);
                    // ä½¿ç”¨é»˜è®¤æ•°æ®
                    marketData = getDefaultData();
                    renderUI();
                    initCharts();
                });
        }
        
        // è·å–é»˜è®¤æ•°æ®ï¼ˆå¤‡ç”¨ï¼‰
        function getDefaultData() {
            return {
                "timestamp": new Date().toISOString(),
                "date": new Date().toISOString().split('T')[0],
                "spot_price": {
                    "battery_grade": 80500,
                    "industrial_grade": 78300,
                    "daily_change_percent": -0.5
                },
                "futures_price": {
                    "lc_main": 79800,
                    "daily_change_percent": 0.3
                },
                "ai_analysis": "ä»Šæ—¥ç”µæ± çº§ç¢³é…¸é”‚ç°è´§å¾®è·Œ0.5%ï¼Œä»·æ ¼é«˜ä½éœ‡è¡ï¼ŒæœŸè´§ä»·æ ¼æ˜¾è‘—ä½äºç°è´§ï¼ŒçŸ­æœŸä¾›éœ€ä»è¶‹ç´§ä½†å¢ä»“å‹åŠ›æ˜¾ç°ã€‚",
                "price_history": generateMockHistory()
            };
        }
        
        // ç”Ÿæˆæ¨¡æ‹Ÿå†å²æ•°æ®
        function generateMockHistory() {
            const history = [];
            const basePrice = 80500;
            for (let i = 30; i > 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const price = basePrice + (i % 10) * 500 - 2000;
                history.push({
                    date: date.toISOString().split('T')[0],
                    price: price
                });
            }
            return history;
        }
        
        // æ¸²æŸ“ UI
        function renderUI() {
            // æ›´æ–°æ—¥æœŸ
            const date = new Date(marketData.date);
            document.getElementById('reportDate').textContent = 
                `${date.getFullYear()}å¹´${date.getMonth() + 1}æœˆ${date.getDate()}æ—¥`;
            
            // æ›´æ–°æ—¶é—´
            const updateTime = new Date(marketData.timestamp);
            document.getElementById('updateTime').textContent = 
                updateTime.toLocaleTimeString('zh-CN');
            
            // æ›´æ–° AI åˆ†ææ‘˜è¦
            const aiSummaryDiv = document.getElementById('aiSummary');
            aiSummaryDiv.innerHTML = `<p>${marketData.ai_analysis}</p>`;
            
            // æ›´æ–°ä»·æ ¼å¡ç‰‡
            const batteryPrice = marketData.spot_price.battery_grade;
            const industrialPrice = marketData.spot_price.industrial_grade;
            const futuresPrice = marketData.futures_price.lc_main;
            const change = marketData.spot_price.daily_change_percent;
            const futuresChange = marketData.futures_price.daily_change_percent;
            
            // ç”µæ± çº§ç¢³é…¸é”‚
            document.getElementById('batteryPrice').textContent = 
                batteryPrice.toLocaleString('zh-CN', {maximumFractionDigits: 0});
            document.getElementById('batteryChange').innerHTML = 
                `<span class="${change >= 0 ? 'change-up' : 'change-down'}">
                    ${change >= 0 ? 'ğŸ“ˆ' : 'ğŸ“‰'} ${change > 0 ? '+' : ''}${change.toFixed(2)}%
                </span>`;
            
            // æ›´æ–°å¡ç‰‡èƒŒæ™¯è‰²
            const batteryCard = document.getElementById('batteryCard');
            batteryCard.classList.remove('up', 'down');
            batteryCard.classList.add(change >= 0 ? 'up' : 'down');
            
            // å·¥ä¸šçº§ç¢³é…¸é”‚
            document.getElementById('industrialPrice').textContent = 
                industrialPrice.toLocaleString('zh-CN', {maximumFractionDigits: 0});
            document.getElementById('industrialChange').innerHTML = 
                `<span class="${change >= 0 ? 'change-up' : 'change-down'}">
                    ${change >= 0 ? 'ğŸ“ˆ' : 'ğŸ“‰'} ${change > 0 ? '+' : ''}${change.toFixed(2)}%
                </span>`;
            
            const industrialCard = document.getElementById('industrialCard');
            industrialCard.classList.remove('up', 'down');
            industrialCard.classList.add(change >= 0 ? 'up' : 'down');
            
            // æœŸè´§ä¸»åŠ›åˆçº¦
            document.getElementById('futuresPrice').textContent = 
                futuresPrice.toLocaleString('zh-CN', {maximumFractionDigits: 0});
            document.getElementById('futuresChange').innerHTML = 
                `<span class="${futuresChange >= 0 ? 'change-up' : 'change-down'}">
                    ${futuresChange >= 0 ? 'ğŸ“ˆ' : 'ğŸ“‰'} ${futuresChange > 0 ? '+' : ''}${futuresChange.toFixed(2)}%
                </span>`;
            
            const futuresCard = document.getElementById('futuresCard');
            futuresCard.classList.remove('up', 'down');
            futuresCard.classList.add(futuresChange >= 0 ? 'up' : 'down');
            
            // ä»·æ ¼å·®å¼‚
            const priceDiff = batteryPrice - futuresPrice;
            document.getElementById('priceDiff').textContent = 
                priceDiff.toLocaleString('zh-CN', {maximumFractionDigits: 0});
            document.getElementById('diffAnalysis').textContent = 
                priceDiff > 0 ? 'ç°è´§é«˜äºæœŸè´§' : 'ç°è´§ä½äºæœŸè´§';
        }
        
        // åˆå§‹åŒ–å›¾è¡¨
        function initCharts() {
            initPriceChart();
            initSupplyDemandChart();
        }
        
        // åˆå§‹åŒ–ä»·æ ¼èµ°åŠ¿å›¾
        function initPriceChart() {
            const chartDom = document.getElementById('priceChart');
            chartInstance1 = echarts.init(chartDom);
            
            const dates = marketData.price_history.map(item => item.date);
            const prices = marketData.price_history.map(item => item.price);
            
            const option = {
                responsive: true,
                maintainAspectRatio: false,
                title: {
                    text: '',
                    left: 'center'
                },
                tooltip: {
                    trigger: 'axis',
                    backgroundColor: 'rgba(0, 0, 0, 0.7)',
                    borderColor: '#667eea',
                    textStyle: {
                        color: '#fff'
                    },
                    formatter: function(params) {
                        if (params.length > 0) {
                            return params[0].axisValue + '<br/>' + 
                                   'ä»·æ ¼: ' + params[0].value.toLocaleString() + ' å…ƒ/å¨';
                        }
                    }
                },
                grid: {
                    left: '10%',
                    right: '10%',
                    bottom: '15%',
                    top: '10%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: dates,
                    boundaryGap: false,
                    axisLabel: {
                        interval: Math.floor(dates.length / 6),
                        fontSize: 12
                    }
                },
                yAxis: {
                    type: 'value',
                    axisLabel: {
                        formatter: '{value}'
                    }
                },
                series: [
                    {
                        data: prices,
                        type: 'line',
                        smooth: true,
                        itemStyle: {
                            color: '#667eea'
                        },
                        lineStyle: {
                            color: '#667eea',
                            width: 3
                        },
                        areaStyle: {
                            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                { offset: 0, color: 'rgba(102, 126, 234, 0.3)' },
                                { offset: 1, color: 'rgba(102, 126, 234, 0.05)' }
                            ])
                        },
                        symbolSize: 6,
                        showSymbol: false
                    }
                ]
            };
            
            chartInstance1.setOption(option);
            window.addEventListener('resize', function() {
                chartInstance1.resize();
            });
        }
        
        // åˆå§‹åŒ–ä¾›éœ€åˆ†æå›¾
        function initSupplyDemandChart() {
            const chartDom = document.getElementById('supplyDemandChart');
            chartInstance2 = echarts.init(chartDom);
            
            const option = {
                responsive: true,
                maintainAspectRatio: false,
                tooltip: {
                    trigger: 'axis',
                    backgroundColor: 'rgba(0, 0, 0, 0.7)',
                    borderColor: '#667eea',
                    textStyle: {
                        color: '#fff'
                    }
                },
                grid: {
                    left: '10%',
                    right: '10%',
                    bottom: '15%',
                    top: '10%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: ['é”‚çŸ¿ä¾›åº”', 'å†¶ç‚¼äº§èƒ½', 'åº“å­˜æ°´ä½', 'ä¸‹æ¸¸éœ€æ±‚', 'å¸‚åœºé¢„æœŸ'],
                    axisLabel: {
                        fontSize: 12
                    }
                },
                yAxis: {
                    type: 'value',
                    name: 'ç›¸å¯¹å¼ºåº¦'
                },
                series: [
                    {
                        data: [75, 72, 65, 88, 70],
                        type: 'bar',
                        itemStyle: {
                            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                { offset: 0, color: '#667eea' },
                                { offset: 1, color: '#764ba2' }
                            ])
                        },
                        borderRadius: [8, 8, 0, 0],
                        label: {
                            show: true,
                            position: 'top',
                            fontSize: 12,
                            color: '#333'
                        }
                    }
                ]
            };
            
            chartInstance2.setOption(option);
            window.addEventListener('resize', function() {
                chartInstance2.resize();
            });
        }
        
        // åˆ·æ–°æ•°æ®
        function refreshData() {
            const btn = event.target;
            btn.disabled = true;
            btn.textContent = 'ğŸ”„ åˆ·æ–°ä¸­...';
            
            // é‡æ–°åŠ è½½æ•°æ®
            setTimeout(() => {
                loadMarketData();
                btn.disabled = false;
                btn.textContent = 'ğŸ”„ åˆ·æ–°æ•°æ®';
            }, 1500);
        }
        
        // PDF å¯¼å‡ºåŠŸèƒ½
        async function exportPDF() {
            const btn = event.target;
            btn.disabled = true;
            btn.textContent = 'ğŸ“¥ å¯¼å‡ºä¸­...';
            
            try {
                const element = document.querySelector('.container');
                const canvas = await html2canvas(element, {
                    scale: 2,
                    useCORS: true,
                    logging: false,
                    backgroundColor: '#ffffff'
                });
                
                const imgData = canvas.toDataURL('image/png');
                const pdf = new jsPDF('p', 'mm', 'a4');
                
                const imgWidth = 210; // A4 å®½åº¦
                const pageHeight = 297; // A4 é«˜åº¦
                let heightLeft = canvas.height * imgWidth / canvas.width;
                let position = 0;
                
                // æ·»åŠ ç¬¬ä¸€é¡µ
                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, heightLeft);
                heightLeft -= pageHeight;
                
                // æ·»åŠ åç»­é¡µé¢
                while (heightLeft >= 0) {
                    position = heightLeft - canvas.height * imgWidth / canvas.width;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, heightLeft);
                    heightLeft -= pageHeight;
                }
                
                // ä¸‹è½½ PDF
                const date = new Date(marketData.date);
                const filename = `é”‚çŸ¿ç¢³é…¸é”‚å¸‚åœºæ—¥æŠ¥_${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}.pdf`;
                pdf.save(filename);
                
                btn.disabled = false;
                btn.textContent = 'ğŸ“¥ å¯¼å‡º PDF æŠ¥å‘Š';
            } catch (error) {
                console.error('PDF å¯¼å‡ºå¤±è´¥:', error);
                alert('PDF å¯¼å‡ºå¤±è´¥ï¼Œè¯·é‡è¯•');
                btn.disabled = false;
                btn.textContent = 'ğŸ“¥ å¯¼å‡º PDF æŠ¥å‘Š';
            }
        }
    </script>
</body>
</html>
